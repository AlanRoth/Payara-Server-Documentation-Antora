[[configuring-hazelcast]]
== Configuring the Domain Data Grid underlying Hazelcast
:toc:
:toclevels: 3

Payara Server supports configuring Hazelcast through the Admin Console and
asadmin commands. The Hazelcast configuration file can also be directly edited,
but will not be covered in depth in this section.

Configuration of Hazelcast is divided into four sections. The first section 
applies to the whole domain, the second section applies to specific configurations 
and therefore to Payara Server instances that use that configuration, the 
third section covers how certain settings can be specified when a domain is created
and the final section covers how to configure config specific Data Grid Start Port 
during or after the creation of an instance.

Using a Hazelcast configuration file will cause the settings set via the Admin
Console and _asadmin_ commands to be ignored. Any parameters not specified in
the configuration file reverting to the Hazelcast defaults, even if they are
specified in the Admin Console or _domain.xml_ (Note - the
https://github.com/hazelcast/hazelcast/blob/master/hazelcast/src/main/resources/hazelcast-default.xml[Hazelcast defaults]
are not necessarily the same as the Payara Hazelcast defaults).

NOTE: Payara Server uses its
https://github.com/payara/Payara/blob/master/nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/hazelcast/PayaraHazelcastSerializer.java[own serializer]
instead of the default Hazelcast one. Setting a global serializer will not override it.
This was created to avoid a https://github.com/payara/Payara/issues/759[bug]
that causes `ClassNotFoundException` errors.


[[setting-hazelcast-configuration-file]]
=== Setting a Hazelcast Configuration File

Hazelcast configuration file can be either set using Admin Console or asadmin CLI.

[[setting-hazelcast-configuration-file-admin-console]]
==== Setting a Hazelcast Configuration File with the Admin Console

To set the Hazelcast configuration from a Hazelcast Configuration file:

. Select the domain Data Grid configuration from the page tree and click the
*Configuration* tab to view the _"Hazelcast Configuration"_ page:

. On the _Hazelcast Configuration_ page, add the path to your Hazelcast
Configuration file and click "Save". This path is relative to your domain
configuration directory:
+
image::hazelcast/hazelcast-admin-console-set-configuration-file.png[Hazelcast Set Configuration File]

[[setting-hazelcast-configuration-file-asadmin]]
==== Setting a Hazelcast Configuration File using asadmin

The `set-hazelcast-configuration` command can be used to set the configuration
file:

[source, shell]
----
asadmin> set-hazelcast-configuration --hazelcastconfigurationfile /path/to/file
----

As with the admin console, this path is relative to your domain configuration
directory.

[[configuring-domain-wide-hazelcast-with-the-admin-console]]
=== Configuring Domain Wide Hazelcast Settings with the Admin Console

Some Hazelcast configuration settings apply to the whole domain.
Navigate to the _Data Grid_ page for the domain wide settings.

image::hazelcast/hazelcast-admin-console-domain-hazelcast-options.png[Data Grid Domain Wide Options]

The following configuration options are available here:

[cols="4,6",options="header",]
|====
|Property |Description
|Restart Data Grid |Determines if the Hazelcast member embedded in Payara will be
restarted to apply any changes made

|DAS Bind Address|Explicity specifies the IP Address the DAS should bind the Hazelcast instance to.
By default, Hazelcast will try to choose the correct bind address from the IP addresses available
on the host. If you find the DAS is binding to an incorrect IP Address the correct address
can be specified here.

|DAS Public Address|This is the public IP Address that the DAS should use if the DAS is
behind a NAT firewall and other Payara Server Instances need to connect via the public
NAT address rather than the internal IP Address

|Auto Increment Port| By default the cluster uses the next unoccupied port that is available starting with the start port. When auto-increment is turned off an occupied start port results in a startup failure instead.

|DAS Start Port | The port the DAS uses to run Hazelcast on. If this port is busy, the port
specified will be incremented until a valid port is found.

|Network Interfaces | Similar to DAS Bind address by default Hazelcast will choose the correct
IP Address to bind to. If you find Hazelcast is binding to the incorrect address a comma separated
list of IP Addresses can be specified here.

|Override Configuration File |Specifies the Hazelcast configuration file
to use. The path specified is relative to the domain _config_ directory.

If you are using a custom configuration for a cluster
or standalone instance (e.g. _cluster-config_), then the Hazelcast 
configuration file should be placed in the directory with the same name
(e.g. _<domain-root>/config/cluster-config_). This will ensure it is
replicated to the node during startup.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults.

|Data Grid Group Name | Specifies the Hazelcast group name, to be optionally used
 to help divide clusters into logical, segregated groups (i.e. _dev-group_,
   _prod-group_).

|Start Port|The port the other Payara Server instances use to run Hazelcast on. If this port is busy, the port
specified will be incremented until a valid port is found.

|License Key |Enables
https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.

|Host Aware Partitioning |Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware partitioning]
 for the cluster.
Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for
this feature to work correctly. This is default in Payara Server 5.181 onwards for both
Payara Server domains and Payara Micro instances.

|Data Grid Discovery Mode | See xref:documentation/payara-server/hazelcast/discovery.adoc[Discovery Modes]

|====

[[configuring-config-specifc-hazelcast-with-the-admin-console]]
=== Configuring Server Config Specfic Hazelcast Settings with the Admin Console

Navigate to the _Data Grid_ page for the specific configuration.

image::hazelcast/hazelcast-admin-console-config-hazelcast-options.png[Data Grid Domain Wide Options]

The following configuration options are available here:

[cols=",",options="header",]
|====
|Property |Description

|Enabled | See xref:documentation/payara-server/hazelcast/enable-hazelcast.adoc[Disabling Data Grid] for detailed information

|Restart Data Grid |Determines if the Hazelcast member embedded in Payara will be
restarted to apply any changes made

|Lite Data Grid Instance|If set to true, cluster members with this configuration
will be Hazelcast "lite" nodes, meaning they will not store any cache data
locally and rely on other cluster members to store data.
|Config Specific Data Grid Start Port| Sets Data Grid Start Port to the instance. If set to 0 (default) the Domain wide start port will be used instead.
|Public Address for this Data Grid Node|The Public Address to use for this Data Grid Node. Used when the node is behind a NAT

|Instance Group | Instance group name for all Server Instances using the configuration.
Future functionality may use this name.

|Hazelcast Instance JNDI Name |The JNDI name to bind the Hazelcast instance to.
|JCache Manager JNDI Name| The JNDI name to bind the JCache Cache Manager to.
|JCache Caching Provider JNDI Name|The JNDI name to bind the JCache Caching Provider to.

|Executor Pool Size| The threadpool size for the Hazelcast Executor service
|Executor Queue Capacity | Queue Capacity of the Data Grid Executor Service. Executions are queued until a thread is available
|Scheduled Executor Pool Size| The threadpool size for the Hazelcast Scheduled Executor service
|Scheduled Executor Queue Capacity | Queue Capacity of the Data Grid Scheduled Executor Service. Executions are queued until a thread is available
|====

Enter your required values, and click _Save_. Restarting the domain or
instance/cluster is not necessary for any changes made to take effect, provided
that _"Dynamic"_ remains set to "_true_"

[[configuring-hazelcast-on-domain-creation]]
=== Configuring Hazelcast on Domain Creation

The following options can be used with the `create-domain` command to specify certain Hazelcast settings when a domain is created:

[cols="3,1,4,1,1",options="header"]
|====
|Option|Type|Description|Default|Mandatory

| `--hazelcastdasport` | Port Number | The port to run Hazelcast on for the DAS. 
If this port is busy and auto-increment option is enabled, the port specified 
will be incremented until a valid port is found. The `--hazelcastdasport` 
option cannot be used with the `--portbase` option. The `--hazelcastdasport` 
option overrides the `hazelcast.das.port` property of the `--domainproperties` 
option. | 4900 | No

| `--hazelcaststartport` | Port Number | The port the other Payara Server 
instances use to run Hazelcast on. If this port is busy and auto-increment 
option is enabled, the port specified will be incremented until a valid port is 
found. The `--hazelcaststartport` option cannot be used with the `--portbase` 
option. The `--hazelcaststartport` option overrides the hazelcast.start.port 
property of the `--domainproperties` option. | 5900 | No

| `--hazelcastautoincrement` | Boolean | By default the Data Grid uses the next 
unoccupied port that is available starting with the start port. When 
auto-increment is turned off an occupied start port results in a startup failure 
instead. The `--hazelcastautoincrement` option overrides the `hazelcast.auto.increment` 
property of the `--domainproperties` option. | 5900 | No
|====

The following domain properties have been added  to the 'create-domain' command 
to make it possible to configure certain Hazelcast setting when a domain is created:

[cols=(,,,,),options="header"]
|====
|Property|Description

| `hazelcast.das.port` | This property specifies the port number of the port the
 DAS use to run Hazelcast on. The `hazelcast.das.port` property is overridden by 
the `--hazelcastdasport` option.

| `hazelcast.start.port` | This property specifies the port number of the port 
the other Payara Server instances use to run Hazelcast on. The hazelcast.start.port 
property is overridden by the `--hazelcaststartport` option.

| `hazelcast.auto.increment` | This property specifies whether or not to use the 
next unoccupied port that is available starting with the start port. When auto-increment 
is turned off an occupied start port results in a startup failure instead. The 
hazelcast.auto.increment property is overridden by the `--hazelcastautoincrement` option.
|====

NOTE: If the `portbase` options are used, the values for the ports of the 
Hazelcast DAS start port and the Hazelcast start Port are calculated as follows: 
Hazelcast DAS start port: _portbase_ + 49 and Hazelcast start port: _portbase_ + 59.

*The following examples demonstrate creating a domain with all of the Hazelcast 
related options:*

An example of `create-domain` command with Hazelcast specific options:
[source, shell]
----
asadmin> asadmin create-domain --hazelcastdasport 7900 --hazelcaststartport 8900 --hazelcastautoincrement true testDomain

Using default port 4848 for Admin.
Using default port 8080 for HTTP Instance.
Using default port 7676 for JMS.
Using default port 3700 for IIOP.
Using default port 8181 for HTTP_SSL.
Using default port 3820 for IIOP_SSL.
Using default port 3920 for IIOP_MUTUALAUTH.
Using default port 8686 for JMX_ADMIN.
Using default port 6666 for OSGI_SHELL.
Using default port 9009 for JAVA_DEBUGGER.
Using port 7900 for Hazelcast DAS.
Using port 8900 for Hazelcast Start.
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=dev,OU=Payara,O=Payara Foundation,L=Great Malvern,ST=Worcestershire,C=UK]
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=dev-instance,OU=Payara,O=Payara Foundation,L=Great Malvern,ST=Worcestershire,C=UK]
Domain testDomain created.
Domain testDomain admin port is 4848.
Domain testDomain allows admin login as user "admin" with no password.
Command create-domain executed successfully.
----

An example of `create-domain` command with Hazelcast specific domain properties:
[source, shell]
----
asadmin> create-domain --domainproperties hazelcast.das.port=7900:hazelcast.auto.increment=false:hazelcast.start.port=8900 testDomain

Using default port 8080 for HTTP Instance.
Using default port 7676 for JMS.
Using default port 3700 for IIOP.
Using default port 8181 for HTTP_SSL.
Using default port 3820 for IIOP_SSL.
Using default port 3920 for IIOP_MUTUALAUTH.
Using default port 8686 for JMX_ADMIN.
Using default port 6666 for OSGI_SHELL.
Using default port 9009 for JAVA_DEBUGGER.
Using port 7900 for Hazelcast DAS.
Using port 8900 for Hazelcast Start.
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=dev,OU=Payara,O=Payara Foundation,L=Great Malvern,ST=Worcestershire,C=UK]
Distinguished Name of the self-signed X.509 Server Certificate is:
[CN=dev-instance,OU=Payara,O=Payara Foundation,L=Great Malvern,ST=Worcestershire,C=UK]
Domain testDomain created.
Domain testDomain admin port is 4848.
Domain testDomain allows admin login as user "admin" with no password.
Command create-domain executed successfully.
----

[[configuring-config-specific-data-grid-start-port]]
=== Configuring Config Specific Data Grid Start Port

It is possible to configure the port used by Hazelcast to bind the corresponding 
instance to the Data Grid by letting users set its value during or after the 
creation of an instance.

[[configuring-config-specific-data-grid-start-port-on-instance-creation]]
==== Configuring Config Specific Data Grid Start Port on Instance Creation
The following option can be used with the `create-instance` or the `create-local-instance` commands 
to specify config Specific Data Grid Start Port when an instance is created:

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory

| `--dataGridStartPort` | Port Number | Sets Data Grid Start Port to the instance. 
If set to 0 the Domain wide start port will be used instead | 0 | No
|====

**The following examples demonstrate creating an instance with `--dataGridStartPort` options:**

An example of `create-instance` command:
[source, shell]
----
asadmin> asadmin create-instance --dataGridStartPort 2900 --node localhost-domain1 instance1

Command _create-instance-filesystem executed successfully.
Port Assignments for server instance instance1: 
OSGI_SHELL_TELNET_PORT=26666
JAVA_DEBUGGER_PORT=29009
JMS_PROVIDER_PORT=27676
HTTP_LISTENER_PORT=28080
IIOP_SSL_LISTENER_PORT=23820
ASADMIN_LISTENER_PORT=24848
IIOP_SSL_MUTUALAUTH_PORT=23920
JMX_SYSTEM_CONNECTOR_PORT=28686
HTTP_SSL_LISTENER_PORT=28181
IIOP_LISTENER_PORT=23700
The instance, instance1, was created on host localhost
Command create-instance executed successfully.
----

An example of `create-local-instance` command:
[source, shell]
----
asadmin> asadmin create-local-instance --dataGridStartPort 2900 --node localhost-domain1 instance2

Rendezvoused with DAS on localhost:4848.
Using DAS host localhost and port 4848 from existing das.properties for node
localhost-domain1. To use a different DAS, create a new node using create-node-ssh or
create-node-config. Create the instance with the new node and correct
host and port:
asadmin --host das_host --port das_port create-local-instance --node node_name instance_name.
Port Assignments for server instance instance2: 
OSGI_SHELL_TELNET_PORT=26667
JAVA_DEBUGGER_PORT=29010
JMS_PROVIDER_PORT=27677
HTTP_LISTENER_PORT=28081
IIOP_SSL_LISTENER_PORT=23821
ASADMIN_LISTENER_PORT=24849
IIOP_SSL_MUTUALAUTH_PORT=23921
JMX_SYSTEM_CONNECTOR_PORT=28687
HTTP_SSL_LISTENER_PORT=28182
IIOP_LISTENER_PORT=23701
Command create-local-instance executed successfully.
----

[[configuring-config-specific-data-grid-start-port-After-instance-creation]]
==== Configuring Config Specific Data Grid Start Port After Instance Creation

Config Specific Data Grid Start Port can be either set using Admin Console or asadmin CLI
after an instance has been created.

[[setting-config-specific-data-grid-start-port-with-the-admin-console]]
===== Setting Config Specific Data Grid Start Port with the Admin Console

. Select the Configuration from the page tree, click on the relevant instance and finally click on the Data Grid.

. On the Configuration Specific Data Grid Configuration, set your Data Grid Start Port and click Save.

image::hazelcast/hazelcast-admin-console-config-data-grid-start-port.png[Config Specific Data Grid Start Port Option]

[[setting-hazelcast-configuration-file-asadmin-2]]
===== Setting a Config Specific Data Grid Start Port using asadmin CLI

The `set-hazelcast-configuration` command can be used to set the Config Specific Data Grid Start Port:

[source, shell]
----
asadmin> set-hazelcast-configuration --dynamic=true --configSpecificDataGridStartPort=2900 --target=instance1-config
----

[[configuring-hazelcast-using-asadmin]]
==== Configuring Hazelcast using Asadmin

As noted in the enable Hazelcast section, the `set-hazelcast-configuration`
asadmin command is used to both enable/disable Hazelcast, and to
configure it. The `set-hazelcast-configuration` command is used to set both domain wide
and config specific settings. You can pass the `--help` option to the command to see
usage instructions and available arguments in your terminal, both of which
are listed below:

[cols="3,1,4,1,1",options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--enabled`| Boolean| Enables Hazelcast. If no `target` is specified, this
will enable Hazelcast on the domain configuration _(server-config)_.

If no arguments are specified, defaults to _true_.

If other options are specified, asadmin will interactively prompt for
`--enabled`.| _true_ | No

|`--target`|Config Name|Specifies the instance or cluster to configure.
|`domain`|No

|`--dynamic` |Boolean|Enable or disable dynamic stopping and starting of the
embedded Hazelcast member.|_false_|No
|`-f`

`--hazelcastconfigurationfile`|File Path |The Hazelcast configuration file to
use. This path is relative to the domain config directory,
`<Payara Installation Directory>/glassfish/domains/<Domain Name>/config/`.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults.|`hazelcast-config.xml`
| No

|`--startport` |Port Number|The port to run Hazelcast on for Payara Server Instances. If this port is busy,
the port specified will be incremented until a valid port is found. |5900 |No

|`--daspublicaddress`|IP Address|This is the public IP Address that the DAS should use if the DAS is
behind a NAT firewall and other Payara Server Instances need to connect via the public
NAT address rather than the internal IP Address|None|No

|`--dasbindaddress`|IP Address|Explicity specifies the IP Address the DAS should bind the Hazelcast instance to.
By default, Hazelcast will try to choose the correct bind address from the IP addresses available
on the host. If you find the DAS is binding to an incorrect IP Address the correct address
can be specified here.| None|No

|`--dasport`|Port Number|The port to run Hazelcast on for the DAS. If this port is busy,
the port specified will be incremented until a valid port is found. |4900 |No

|`--publicaddress`|IP Address|The Public Address to use for this Data Grid Node. Used when the node is behind a NAT|None|No

|`--interfaces`|IP Addresses|Similar to DAS Bind address by default Hazelcast will choose the correct
IP Address to bind to. If you find Hazelcast is binding to the incorrect address a comma separated
list of IP Addresses can be specified here.|None|No

|`--clustername` |Group Name|Specifies the Hazelcast group name, to be
optionally used to help divide clusters into logical, segregated groups (i.e.
_dev-group_, _prod_group_).||No


|`--hostawarepartitioning` |Boolean|Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware partitioning]
 for the cluster.
Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for this
feature to work correctly.|_false_|No

|`--licensekey`

`-lk` |Hazelcast License|Enables https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.||No

|`--clustermode`|Cluster Mode|Can be one of `domain`, `tcpip` or `multicast`. See xref:documentation/payara-server/hazelcast/discovery.adoc[Discovery Modes] for
a detailed description of each mode | None|No

|`--multicastgroup`

`-g` |Multicast Address|The multicast group for
communications in the Hazelcast instance if `multicast` is selected as cluster mode.|224.2.2.3|No

|`--multicastport` |Port Number |The multicast port for communications in the Hazelcast
instance if `multicast` is selected as cluster mode.|54327|No

|`--tcpipmembers`|IP Addresses|Comma separated list of `IP-Address:port` used to discover
cluster members if `tcpip` is selected as the cluster mode.|None|No


|`--lite` |Boolean|Sets the cluster to lite mode, where it will cluster but *not*
store any cluster data.|_false_|No

|`--configSpecificDataGridStartPort` |Port Number|Sets Data Grid Start Port to the instance. 
If set to 0 the Domain wide start port will be used instead.|0|No

|`--jndiname`

`-j` |JNDI Name|Specifies the JNDI name to bind the Hazelcast
instance to.||

|`--cachemanagerjndiname`|JNDI Name|Specified the JNDI name to bind the JCache Caching provider
||

|--cachingproviderjndiname|JNDI Name|The JNDI name to bind the JCache Caching Provider to.||

|--executorpoolsize|Integer| The threadpool size for the Hazelcast Executor service||
|--executorqueuecapacity|Integer| Queue Capacity of the Data Grid Executor Service. Executions are queued until a thread is available  ||
|--scheduledexecutorpoolsize|Integer| The threadpool size for the Hazelcast Scheduled Executor service||
|--scheduledexecutorqueuecapacity|Integer| Queue Capacity of the Data Grid Scheduled Executor Service. Executions are queued until a thread is available  ||
|--membername|String|Member name|instance name|
|--membergroup|String|Instance group name for all Server Instances using the configuration.
Future functionality may use this name.|config name|

|--encryptdatagrid|Boolean|Enables or disables encryption of data stored in the data grid store using a key created using the `generate-encryption-key` command |_false_|No

|`--help`

`-?` ||Displays the help menu.|_false_|No
|====

The following example demonstrates setting all of the options on a
cluster called _cluster1_:

[source, shell]
----
asadmin> set-hazelcast-configuration --enabled=true --target=cluster1 --dynamic=true -f hazelcast-config.xml --startport=5902 -g 224.2.2.3 --multicastport=6666 --clustermode multicast --hostAwareParitioning=true -j payara/Hazelcast
----

[[using-datagrid-in-your-applications]]
== Using the Data Grid in your Applications

The following sections will detail how to use the underlying Data Grid Hazelcast instance in
Payara within your code.

[[accessing-the-jndi-registered-hazelcast-instance]]
=== Accessing the JNDI registered Hazelcast instance

By default, the JNDI name of the hazelcast instance is
_payara/Hazelcast_, though this can be altered using the
`set-hazelcast-configuration` command.

You will need to import the following packages into your Java class:

[source, java]
----
import com.hazelcast.core.HazelcastInstance;
import javax.naming.Context;
import javax.naming.InitialContext;
----

To import the Hazelcast package, you will need to set the Payara
Hazelcast package as a dependency in the project _pom.xml_ file (for
Maven projects), or have the Hazelcast JAR set as a project
dependency (if using a non-Maven based project). To add the Payara
Hazelcast package as a dependency in a POM, enter the following in the
dependencies section:

[source, xml]
----
<dependency>
  <groupId>fish.payara.api</groupId>
  <artifactId>payara-api</artifactId>
  <version>{currentVersion}</version>
</dependency>
----

The Hazelcast JAR (for non-Maven projects), can either be downloaded
from the http://hazelcast.org/download/[Hazelcast website], or you can
make use of the JAR packaged with Payara. The JAR packaged with Payara
can be found at _<Payara Installation Directory>/glassfish/modules/hazelcast.jar_.

The following will initialize a `HazelcastInstance` variable in the
instance embedded in Payara:

[source, java]
----
Context ctx = new InitialContext();
HazelcastInstance instance = (HazelcastInstance) ctx.lookup("payara/Hazelcast");
----

You will have to wrap this in a `try-catch` clause, or throw the
`NamingException` exception that this code can generate.

[[using-hazelcast-for-the-web-and-ejb-container-persistence]]
=== Using Hazelcast for Web and EJB Container Persistence

Hazelcast can be used as the persistence provider for both Web and EJB
containers.

[[setting-hazelcast-as-the-persistence-provider-through-the-admin-console]]
==== Setting Hazelcast as the Persistence provider through the Admin Console

NOTE: Note on Payara Server hazelcast is the default persistence provider.

To set up Hazelcast for persistence:

. Select the instance's configuration from the page tree:
. Select _"Availability Service"_ to view the _"Availability Service"_ page:
+
image::hazelcast/hazelcast-admin-console-select-availability-service.png[Availability Service]

===== Setting Web Persistence

. Open the "Web Container Availability" tab, and select "Hazelcast" from the
Persistence Type drop-down menu:
+
image::hazelcast/hazelcast-admin-console-availability-enable-web-persistence.png[Web Persistence]

. Save the changes.

===== Setting EJB Persistence

. Open the "EJB Container Availability" tab and select "Hazelcast" from the
Persistence Type drop-down menu:
+
image::hazelcast/hazelcast-admin-console-availability-enable-ejb-persistence.png[EJB Persistence]

. Save the changes.

[[setting-hazelcast-as-the-persistence-provider-using-asadmin]]
==== Setting Hazelcast as the Persistence provider using Asadmin

To configure the persistence provider with _asadmin_, you have to use
the _set_ command.

[[for-the-web-container-1]]
===== For the Web Container

To set Hazelcast as the persistence provider of the Web Container, run the following
command:

[source, shell]
----
asadmin> set ${Cluster-Config}.availability-service.web-container-availability.persistence-type=hazelcast
----

[[for-the-ejb-container-1]]
===== For the EJB Container

To set Hazelcast as the persistence provider of the EJB Container, run:

[source, shell]
----
asadmin> set ${Cluster-Config}.availability-service.ejb-container-availability.sfsb-ha-persistence-type=hazelcast
----

[[asadmin-commands]]
== Asadmin Commands

The following is a list of the administration commands used to configure Hazelcast.

[[set-hazelcast-configuration]]
=== `set-hazelcast-configuration`

*Usage*::
`asadmin> set-hazelcast-configuration --disabled=true`

*Aim*::
Configures the underlying Hazelcast instance. See xref:documentation/payara-server/hazelcast/configuration.adoc[Data Grid Configuration] for
all the command line options for this command.


[[get-hazelcast-configuration]]
=== `get-hazelcast-configuration`

*Aim*::
Return the current Hazelcast configuration.

*Usage*::
`asadmin> get-hazelcast-configuration`

[[command-options-2]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or Cluster Name|Specifies a particular config|
`server`|No
|`--help`
`-?`||Displays the help menu|_fal
|====

[[example-2]]
==== Example

[source, shell]
----
asadmin> get-hazelcast-configuration
Configuration File    Enabled  Start Port  MulticastGroup  MulticastPort  JNDIName            Lite Member  Cluster Name  License Key          Host Aware Partitioning
hazelcast-config.xml  true     5900        224.2.2.3       54327          payara/Hazelcast    false        clustername   XXXX-XXXX-XXXX-XXXX  false
----

[[list-hazelcast-cluster-members]]
=== `list-hazelcast-cluster-members`

*Aim*::
List the current members of the DAS' Hazelcast cluster in a formatted table, with
extra properties.

*Usage*::
`asadmin> list-hazelcast-cluster-members`

[[command-options-3]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--type`|`server` or `micro`|Specifies the type of cluster to locate|_Both_|No
|`--help`
`-?`||Displays the help menu|_false_
|====

[[example-3]]
==== Example

[source, shell]
----
asadmin> list-hazelcast-cluster-members --type server
Instance Name  Instance Group  Instance Type  Host Name  HTTP Ports  HTTPS Ports  Admin Port  Hazelcast Port  Lite Member  Deployed Applications
server         server-config   DAS            127.0.1.1  8080        8181         4848        5901            false        __admingui
----

[[list-hazelcast-members]]
=== `list-hazelcast-members`

*Aim*::
List the hazelcast members as a targetable array.

*Usage*::
`asadmin> list-hazelcast-members`

[[command-options-4]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or cluster name|Specifies the targeted instance or
cluster.|`server`|No
|`--help`
`-?`||Displays the help menu|_false_
|====

[[example-4]]
==== Example

[source, shell]
----
asadmin> list-hazelcast-members
\{ server-/127.0.1.1:5901-this \}
----

[[restart-hazelcast]]
=== `restart-hazelcast`

*Aim*::
Restarts Hazelcast for the target.

*Usage*::
`asadmin> restart-hazelcast --target <instance-name>`

[[command-options-5]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
|`--target`|Instance or cluster name|Specifies the targeted instance or
cluster.|`server`|No
|`--help`
`-?`||Displays the help menu|_false_
|====

[[example-5]]
=== Example

[source, shell]
----
asadmin> restart-hazelcast --target instance-name
instance-name:
Hazelcast Restarted
----

WARNING: If multiple Payara Server instances are targeted for restart of the underlying
 Hazelcast instance then data loss can occur in the Data Grid

[[list-cache-keys]]
=== `list-cache-keys`

*Aim*::
Lists all keys in a cache. If no cache is specified, keys from all caches will
be returned.

*Usage*::
`asadmin> list-cache-keys`

[[command-options-6]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory
| name
| String
| Name of the cache to query
|
| No
|====

[[list-caches]]
=== `list-caches`

*Aim*::
Lists the Hazelcast distributed caches in the cluster

*Usage*::
`asadmin list-caches`

[[clear-cache]]
=== `clear-cache`

*Aim*::
Clears a Hazelcast or JCache IMap

*Usage*::
`asadmin> clear-cache <cacheName>`

WARNING: Use of this commands removes all data from a cache and therefore can
result in unexpected behaviour if a system cache is cleared. Clearing a cache
containing web session data will result in all users losing their sessions.

[[create-hazelcast-instance]]
=== `create-hazelcast-instance`

NOTE: By default all instances are created as part of the Domain Data Grid

*Usage*::
`asadmin> create-hazelcast-instance new-instance`

*Aim*::
Creates a new Payara Server instance with Hazelcast and the persistence types.

[[command-options-1]]
==== Command Options

[cols=(,,,,),options="header"]
|====
|Option|Type|Description|Default|Mandatory

|`--node`|Node Name|Specifies the node to create the instance on.||Yes

|`--config`|Config Name|Specifies the config to use for the instance|
`server-config`|No

|`--lbenabled`|Boolean|Specifies whether the instance is enabled for load
balancing, meaning that the load balancer directs requests to the instance.
|_true_|No

|`--checkports`|Boolean|Specifies whether the check that the administration,
HTTP, JMS, JMX, and IIOP ports are free.|_true_|No

|`--terse`|Boolean|Specifies whether output data should be returned in a
concise format, suited for scripts, with descriptive text omitted.|_false_|No

|`--portbase`|Port Number|Specifies the port to start assigning ports from.
This will always output the assigned ports, even when omitted.||No

|`--systemproperties`|Options|Specifies additional system properties which
will override other settings, such as the assigned port. Examples include
`ASADMIN_LISTENER_PORT` and `OSGI_SHELL_TELNET_PORT`.||No

|`--target`|Config Name|Specifies the instance or cluster to configure.|
`server-config`|No

|`--enabled`|Boolean|Enables Hazelcast. If no target is specified, this will
enable Hazelcast on the domain configuration (_server-config_).

If no arguments are specified, defaults to true.|_true_|No

|`--dynamic`|Boolean|Enable or disable dynamic stopping and starting of the
embedded Hazelcast member.|_false_|No

|`--hazelcastconfigurationfile`/

`-f`|File Path|The Hazelcast configuration file to use. This path is relative to the
domain config directory,
<Payara Installation Directory>/glassfish/domains/<Domain Name>/config/.

Using this option to point to a valid Hazelcast configuration file will cause
all other options set to be ignored. Any options unset within the Hazelcast
configuration file will be set to the Hazelcast defaults|`hazelcast-config.xml`
|No

|`--startport`|Port Number|The port to run Hazelcast on. If this port is busy,
the port specified will be incremented until a valid port is found.|5900|No

|`--multicastgroup`

`-g`|Multicast Address|The multicast group for communications in the Hazelcast
instance.|224.2.2.3|No

|`--multicastport`|Port Number|The multicast port for communications in the
instance.||No

|`--clustername`|Group Name|Specifies the Hazelcase group name, to be
optionally used to help divide clusters into logical, segregated groups (i.e.
  _dev-group_, _prod_grop_).||No

|`--jndiname`

`-j`|JNDI Name|Specifies the JNDI name to bind the Hazelcast instance to.||

|`--licensekey`

`-lk`|Hazelcast License|Enables https://hazelcast.com/products/enterprise/[Hazelcast Enterprise]
features.||No

|`--lite`|Boolean|Sets the cluster to lite mode, where it will cluster but
*not* store any data.|_false_|No

|`--hostawarepartitioning`|Boolean|Whether or not to enable
http://docs.hazelcast.org/docs/latest/manual/html-single/index.html#grouping-types[host-aware partitioning]
for the cluster. Host aware partitioning *must be* enabled
on all members of the cluster (including Payara Micro instances) for this
feature to work correctly.|_false_|No

|`--webpersistence`|Boolean|Specifies whether Hazelcast will be used for web
persistence.|_True_|No

|`--ejbpersistence`|Boolean|Specifies whether Hazelcast will be used for web
persistence.|_True_|No

|`--help`

`-?`||Displays the help menu|_false_|No

|====

[[example-1]]
==== Example

[source, shell]
----
asadmin> create-hazelcast-instance --webpersistence=false --lite instance2
----